{% extends 'base.html' %}
{% block content %}
<h1>Order {{ order.reference }}</h1>
<p>
  <strong>Customer:</strong> {{ order.email }}<br>
  <strong>Name:</strong> {{ order.name }}<br>
  <strong>Phone:</strong> {{ order.phone }}<br>
  <strong>City:</strong> {{ order.city }}<br>
  <strong>Subtotal:</strong> {{ order.subtotal|money }}<br>
  <strong>Discount:</strong> {{ order.discount|money }}<br>
  <strong>Total:</strong> {{ order.total|money }}<br>
  <strong>Status:</strong> {{ order.status }}<br>
  <strong>Paid:</strong> {{ 'Yes' if order.paid else 'No' }}
</p>
<h3>Items</h3>
<table class="table">
  <thead><tr><th>Title</th><th>Qty</th><th>Price</th><th>Subtotal</th></tr></thead>
  <tbody>
    {% for it in items %}
    <tr>
      <td style="display:flex; gap:10px; align-items:flex-start">
        {% if it.product and it.product.image %}
          <img src="{{ it.product.image }}" alt="thumb" style="width:56px;height:56px;object-fit:cover;border:1px solid #eee;padding:2px;border-radius:4px" />
        {% endif %}
        <div style="flex:1">
        {% if it.product_id %}
          <a href="{{ url_for('product_detail', pid=it.product_id) }}" style="color:#007bff;text-decoration:none;font-weight:bold">{{ it.title }}</a>
        {% else %}
          <strong>{{ it.title }}</strong>
        {% endif %}
        </div>
      </td>
      <td>{{ it.qty }}</td>
      <td>{{ it.price|money }}</td>
      <td>{{ it.subtotal|money }}</td>
    </tr>
    {% else %}
    <tr><td colspan="4">No items found.</td></tr>
    {% endfor %}
  </tbody>
</table>
<div style="margin-bottom:15px; display:flex; gap:8px; align-items:center">
  <a class="btn btn-secondary" href="{{ url_for('admin_order_invoice', oid=order.id) }}" target="_blank">Print Invoice</a>
  <form method="post" action="{{ url_for('admin_order_update_status', oid=order.id) }}" style="margin:0">
  <div class="form-group">
    <label for="status">Update status</label>
    <select name="status" id="status" class="form-control">
      <option value="pending" {% if order.status=='pending' %}selected{% endif %}>Pending</option>
      <option value="completed" {% if order.status=='completed' %}selected{% endif %}>Completed</option>
      <option value="cancelled" {% if order.status=='cancelled' %}selected{% endif %}>Cancelled</option>
    </select>
  </div>
  <button class="btn btn-primary" type="submit">Update</button>
  <a class="btn btn-secondary" href="{{ url_for('admin_orders') }}">Back</a>
</form>
{% endblock %}
