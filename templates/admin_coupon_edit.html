{% extends 'base.html' %}
{% block content %}
<style>
    .form-container { max-width: 700px; margin: 40px auto; padding: 30px; background: #f9f9f9; border-radius: 8px; }
    .form-container h2 { color: #333; margin-top: 0; border-bottom: 2px solid #27ae60; padding-bottom: 15px; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; }
    .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box; }
    .form-group input:focus, .form-group select:focus { outline: none; border-color: #27ae60; box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1); }
    .form-group small { display: block; color: #666; margin-top: 5px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .checkbox-group { display: flex; align-items: center; }
    .checkbox-group input[type="checkbox"] { margin-right: 10px; width: auto; }
    .checkbox-group label { margin: 0; font-weight: normal; }
    .btn-container { display: flex; gap: 10px; margin-top: 30px; }
    .btn { padding: 12px 20px; border-radius: 6px; font-size: 14px; font-weight: bold; cursor: pointer; border: none; text-decoration: none; display: inline-block; }
    .btn-primary { background: #27ae60; color: white; flex: 1; }
    .btn-primary:hover { background: #229954; }
    .btn-secondary { background: #95a5a6; color: white; }
    .btn-secondary:hover { background: #7f8c8d; }
</style>

<div class="form-container">
    <h2>{% if coupon %}‚úèÔ∏è Edit Coupon{% else %}üéüÔ∏è Create Coupon{% endif %}</h2>

    <form method="post">
        <div class="form-group">
            <label for="code">Coupon Code *</label>
            <input type="text" id="code" name="code" value="{{ coupon.code if coupon else '' }}" required placeholder="e.g., SAVE20" {% if coupon %}disabled{% endif %} />
            <small>Unique code that customers enter. Will be converted to uppercase.</small>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="discount_type">Discount Type *</label>
                <select id="discount_type" name="discount_type" required onchange="updateDiscountLabel()">
                    <option value="percent" {% if coupon and coupon.discount_type == 'percent' %}selected{% endif %}>Percentage (%)</option>
                    <option value="fixed" {% if coupon and coupon.discount_type == 'fixed' %}selected{% endif %}>Fixed Amount (GH‚Çµ)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="discount_value">Discount Value *</label>
                <input type="number" id="discount_value" name="discount_value" value="{{ coupon.discount_value if coupon else '' }}" required step="0.01" placeholder="e.g., 20 or 50" />
                <small id="discount-hint">Max discount percentage</small>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="max_uses">Max Uses (Leave empty for unlimited)</label>
                <input type="number" id="max_uses" name="max_uses" value="{{ coupon.max_uses if coupon and coupon.max_uses else '' }}" min="1" />
            </div>

            <div class="form-group">
                <label for="min_amount">Minimum Order Amount (GH‚Çµ)</label>
                <input type="number" id="min_amount" name="min_amount" value="{{ coupon.min_amount if coupon else '0' }}" step="0.01" min="0" />
            </div>
        </div>

        <div class="form-group">
            <label for="max_discount">Max Discount Cap (GH‚Çµ) - For percentage discounts only</label>
            <input type="number" id="max_discount" name="max_discount" value="{{ coupon.max_discount if coupon and coupon.max_discount else '' }}" step="0.01" placeholder="Leave empty for no limit" />
            <small>Maximum amount that can be discounted if using percentage</small>
        </div>

        <div class="form-group">
            <label for="expiry_date">Expiry Date (Leave empty for no expiry)</label>
            <input type="datetime-local" id="expiry_date" name="expiry_date" value="{% if coupon and coupon.expiry_date %}{{ coupon.expiry_date.strftime('%Y-%m-%dT%H:%M') }}{% endif %}" />
        </div>

        {% if coupon %}
        <div class="form-group checkbox-group">
            <input type="checkbox" id="is_active" name="is_active" {% if coupon.is_active %}checked{% endif %} />
            <label for="is_active">Active (Allow customers to use this coupon)</label>
        </div>

        <div class="form-group">
            <label>Current Usage</label>
            <input type="text" value="{{ coupon.current_uses }}/{% if coupon.max_uses %}{{ coupon.max_uses }}{% else %}‚àû{% endif %}" disabled title="Current coupon usage count" />
            <small>Read-only. Shows how many times this coupon has been used.</small>
        </div>
        {% else %}
        <input type="hidden" name="is_active" value="on" />
        {% endif %}

        <div class="btn-container">
            <a href="/admin/coupons" class="btn btn-secondary">‚Üê Back</a>
            <button type="submit" class="btn btn-primary">{% if coupon %}‚úì Update Coupon{% else %}‚úì Create Coupon{% endif %}</button>
        </div>
    </form>
</div>

<script>
    function updateDiscountLabel() {
        const type = document.getElementById('discount_type').value;
        const hint = document.getElementById('discount-hint');
        if (type === 'percent') {
            hint.textContent = 'Enter percentage value (e.g., 20 for 20%)';
        } else {
            hint.textContent = 'Enter fixed amount in GH‚Çµ';
        }
    }
    updateDiscountLabel();
</script>
{% endblock %}
